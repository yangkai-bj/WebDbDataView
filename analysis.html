<!DOCTYPE html><html><head><meta http-equiv="X-UA-Compatible" content="IE=9" charset="GBK">    <!--兼容模式为IE9--><title></title></head><body><div id="main" align="center" style="font-size: 24px;margin: auto"><br><br><h2>Web SQLite Manager</h2><br><h4>(适用Chrome浏览器)    <br><span style="height: 400px;line-height: 400px;">杨凯&copy;开源项目</span></h4><br><h5>2020/04/18</h5></div><script type="text/javascript">    function showMessage(message){        alert(message);    }    function groupBy(groupid){        //数据分组        var group = [];        try{            for (var i = 0; i < _DATA_.length; i++){                var data = _DATA_[i].data[groupid];                var is = false;                for (var c =0; c < group.length;c++){                    if (data == group[c]){                        is = true;                        break;                    }                    if ((typeof(data) == "number" && typeof(group[c]) == "number" && data < group[c])                    || (typeof(data) == "string" && typeof(group[c]) == "string" && data.toString().localeCompare(group[c].toString()) < 0 )){                        var tmp = data;                        data = group[c];                        group[c] = tmp;                    }                }                if (is == false){                    group.push(data)                }            }        }catch (e) {            showMessage("groupBy:\n" + e.message)        }        return group;    }    function transposeData(){        //转置数据        try {            var columns = [];            columns.push(_COLUMNS_[0]);            for (var i = 0; i < _DATA_.length; i++) {                columns.push({                    "id": _DATA_[i].id,                    "name": _DATA_[i].data[0],                    "display": _DATA_[i].display                });            }            var data = [];            for (var c = 1; c < _COLUMNS_.length; c++) {                var d = [];                d.push(_COLUMNS_[c].name);                for (var i = 0; i < _DATA_.length; i++) {                    d.push(_DATA_[i].data[c]);                }                data.push({                    "id": _COLUMNS_[c].id,                    "data": d,                    "display": _COLUMNS_[c].display                });            }            _COLUMNS_ = columns;            _DATA_ = data;        }catch (e) {            showMessage("transposeData:\n" + e.message);        }    }    function orderBy(){        //数据排序        var id = tableset.order_by.value;        var type = tableset.order_type.value;        try{            var ndata = [];            for (var i = 0;i <_DATA_.length;i++){                var data = _DATA_[i];                for (var x = 0;x<ndata.length;x++){                    if (type == 1){                        <!--ASC-->                        if ((data.display == true && ndata[x].display == true) || (data.display == false && ndata[x].display == false)) {                            //如果display状态相同，则按值排序                            if ((typeof(data.data[id])=="number" && typeof(ndata[x].data[id])=="number" && data.data[id] < ndata[x].data[id])                                || (typeof(data.data[id]) == "string" && typeof(ndata[x].data[id]) == "string" && data.data[id].toString().localeCompare(ndata[x].data[id].toString()) < 0)) {                                var tmp = ndata[x];                                ndata[x] = data;                                data = tmp;                            }                        } else if (data.display == true && ndata[x].display == false){                            //临时队列中的的隐藏数据向后排                            var tmp = ndata[x];                            ndata[x] = data;                            data = tmp;                        }                    } else if (type == 2){                       <!--DESC-->                        if ((data.display == true && ndata[x].display == true) || (data.display == false && ndata[x].display == false)) {                            if ((typeof(data.data[id])=="number" && typeof(ndata[x].data[id])=="number" && data.data[id] > ndata[x].data[id])                                || (typeof(data.data[id]) == "string" && typeof(ndata[x].data[id]) == "string" && data.data[id].toString().localeCompare(ndata[x].data[id].toString()) > 0)) {                                var tmp = ndata[x];                                ndata[x] = data;                                data = tmp;                            }                        } else if (data.display == true && ndata[x].display == false){                            var tmp = ndata[x];                            ndata[x] = data;                            data = tmp;                        }                    }                }                ndata[ndata.length] = data;            }            _DATA_ = ndata;            viewData();        }catch(e){            showMessage("OrderData:\n" + e.message);        }    }    function getStyle(obj) {        //将对象转换为Style        var style = "";        for (var name in obj){            style += name + ":" + obj[name] + ";"        }        return style;    }    function getData(filename,result){        _INTERFACE_CAPTIONS = [filename];        var data = [];        var lines = result.split("\n");        for (var i =0;i<lines.length;i++){            if (i==0) {                _INTERFACE_COLUMNS = lines[i].split(tableset.Separator.options[tableset.Separator.value]);            } else {                data.push(lines[i].split(tableset.Separator.options[tableset.Separator.value]));            }        }        _INTERFACE_DATA = data;        _INITED_ = initData();        viewData();    }    function getToolbox() {        //页面功能菜单        try {            var ul = document.createElement("ul");            ul.id = "MAIN_MENU";            ul.style.cssText = getStyle({                "list-style-type": "none",                "display": "none",                "padding": "0",                "margin": "0",                "position": "absolute",                "width": "600px",                "height": "29px",                "font-size": "50%",                "color": tableset.subheading_color.value,                "cursor": "pointer",                "text-align": "left"            });            var liStyle = {                "background-color": tableset.menu_item_default.value,                "text-align": "center",                "margin": "3px",                "border-bottom": "brown 1px solid",                "height": "29px",                "display": "inline"            };            //打开文件            if (tableset.SourceFile.value == "") {                var openfile = document.createElement("input");                openfile.style.display = "none";                openfile.id = "main_menu_item_openfile";                openfile.type = "file";                openfile.onchange = function () {                    if (window.FileReader) {                        var file = this.files[0];                        tableset.SourceFile.value = file.name;                        var filename = file.name.split(".")[0];                        var reader = new FileReader();                        reader.onload = function () {                            //console.log(this.result);                            getData(filename, this.result);                        }                        reader.readAsText(file, tableset.Charset.options[tableset.Charset.value]);                    } else {                        showMessage("本应用适用于Chrome浏览器或IE10及以上版本。")                    }                };                ul.appendChild(openfile);            } else {                var openfile = document.createElement("a");                openfile.id = "main_menu_item_openfile";                openfile.innerText = tableset.SourceFile.value + " >>>";                ul.appendChild(openfile);            }            //编辑菜单            var li = document.createElement("li");            li.id = "main_menu_edit";            if (tableset.editable.value == 0) {                li.innerHTML = "[编辑]";            } else {                li.innerHTML = "[保存]";            }            li.style.cssText = getStyle(liStyle);            li.onclick = function () {                try {                    if (tableset.editable.value == 0) {                        tableset.editable.value = 1;                    } else {                        var input = document.getElementById("REPORT").getElementsByTagName("input");                        for (var i = 0; i < input.length; i++) {                            if (input[i].type == "text") {                                var r = parseInt(input[i].id.split(",")[0]);                                var c = parseInt(input[i].id.split(",")[1]);                                if (typeof(_DATA_[r].data[c]) == "number") {                                    _DATA_[r].data[c] = Number(input[i].value);                                } else {                                    _DATA_[r].data[c] = input[i].value;                                }                            }                        }                        tableset.editable.value = 0;                    }                    viewData();                } catch (e) {                    showMessage(e.message);                }            };            ul.appendChild(li);            //转置菜单            var li = document.createElement("li");            li.id = "main_menu_transpose";            li.innerHTML = "[转置]";            li.style.cssText = getStyle(liStyle);            li.onclick = function () {                transposeData();                var columns = [];                for (var i =0 ;i<_COLUMNS_.length;i ++){                    columns.push(_COLUMNS_[i].name);                }                tableset.order_by.options = columns;                tableset.order_by.value = 0;                tableset.order_type.value = 0;                tableset.current_page.value = 1;                mapset.row_title_id.options = columns;                mapset.row_title_id.value = 0;                viewData();            };            ul.appendChild(li);            //重置菜单            var li = document.createElement("li");            li.id = "main_menu_reset";            li.innerHTML = "[重置]";            li.style.cssText = getStyle(liStyle);            li.onclick = function () {                _INITED_ = initData();                try {                    var columns = [];                    for (var i = 0; i < _COLUMNS_.length; i++) {                        columns.push(_COLUMNS_[i].name);                    }                    tableset.order_by.options = columns;                    tableset.order_by.value = 0;                    tableset.order_type.value = 0;                    tableset.current_page.value = 1;                    mapset.row_title_id.options = columns;                    mapset.row_title_id.value = 0;                }catch (e) {                    showMessage(e.message);                }                viewData();            };            ul.appendChild(li);            //页面参数            var li = document.createElement("li");            li.id = "main_menu_item_pageset";            li.innerHTML = "[设置]";            li.style.cssText = getStyle(liStyle);            li.onclick = function () {                var main = document.getElementById("main");                var config = getConfigsContent();                main.appendChild(config);                config.style.display = "block";            };            ul.appendChild(li);            //关于            var li = document.createElement("li");            li.id = "main_menu_item_about";            li.innerHTML = "[关于]";            li.style.cssText = getStyle(liStyle);            li.onclick = function () {                showMessage(_SYS_VERSION_LOGS + "\n\n" + _SYS_DEVELOPER + "\n" + _SYS_VERSION);            };            ul.appendChild(li);            return ul;        }catch (e) {            showMessage("getToolbox:\n" + e.message);        }    }    function getConfigsContent(){        //页面设置功能        try {            var div = document.createElement("div");            div.id = "CONFIG";            div.style.cssText = getStyle({                "overflow": "auto",                "text-align": "center",                "background-color": tableset.config_background.value,                "border-bottom": "gray 1px solid",                "color": tableset.config_color.value,                "padding": "10px",                "margin": "0px",                "display": "none",                "position": "absolute",                "top": "70px",                "left": "5px",                "width": "330px",                "height": "800px",                "font-size": "75%",                "border-radius": "5px"            });            div.onmouseleave = function () {                //this.style.display = "none";            };            var title = document.createElement("div");            title.style.cssText = getStyle({                "height": "25px",                "width": "100%",                "border-bottom": "yellow 1px solid",                "margin-bottom": "10px"            });            title.innerHTML = "页面参数";            div.appendChild(title);            var configs = document.createElement("table");            configs.style.width = "100%";            var tr = document.createElement("tr");            configs.appendChild(tr);            var th = document.createElement("th");            th.style.textAlign="left";            th.colSpan = 2;            th.innerHTML = "报表参数";            tr.appendChild(th);            for (var name in tableset) {                tr = document.createElement("tr");                configs.appendChild(tr);                var cell = document.createElement("td");                cell.style.textAlign="right";                cell.innerHTML = tableset[name].name + ":";                tr.appendChild(cell);                cell = document.createElement("td");                cell.style.textAlign="left";                if (tableset[name].type == "select") {                    var input = document.createElement("select");                    input.style.width = "134px";                    input.id = ["tableset", name].toString();                    for (var i = 0; i < tableset[name].options.length; i++) {                        input.options.add(new Option(tableset[name].options[i], i));                    }                    input.value = tableset[name].value;                    cell.appendChild(input);                } else {                    var input = document.createElement("input");                    input.style.width = "130px";                    input.id = ["tableset", name].toString();                    try {                        input.type = tableset[name].type;                    } catch (e) {                        input.type = "text";                    }                    input.value = tableset[name].value;                    cell.appendChild(input);                }                tr.appendChild(cell);            }            var tr = document.createElement("tr");            configs.appendChild(tr);            var th = document.createElement("th");            th.style.textAlign="left";            th.colSpan = 2;            th.innerHTML = "图形参数";            tr.appendChild(th);            for (var name in mapset) {                tr = document.createElement("tr");                configs.appendChild(tr);                var cell = document.createElement("td");                cell.style.textAlign = "right";                cell.innerHTML = mapset[name].name + ":";                tr.appendChild(cell);                cell = document.createElement("td");                cell.style.textAlign = "left";                if (mapset[name].type == "select") {                    var input = document.createElement("select");                    input.style.width = "134px";                    input.id = ["mapset", name].toString();                    for (var i = 0; i < mapset[name].options.length; i++) {                        input.options.add(new Option(mapset[name].options[i], i));                    }                    input.value = mapset[name].value;                    cell.appendChild(input);                } else {                    var input = document.createElement("input");                    input.style.width = "130px";                    input.id = ["mapset", name].toString();                    try {                        input.type = mapset[name].type;                    } catch (e) {                        input.type = "text";                    }                    input.value = mapset[name].value;                    cell.appendChild(input);                }                tr.appendChild(cell);            }            div.appendChild(configs);            var hr = document.createElement("hr");            div.appendChild(hr);            var button = document.createElement("button");            button.innerText = "确定";            button.onclick = function() {                var tags = ["input", "select"];                for (var x = 0; x < tags.length; x++) {                    var tag = document.getElementById("CONFIG").getElementsByTagName(tags[x]);                    for (var i = 0; i < tag.length; i++) {                        var type = tag[i].id.split(",")[0];                        var name = tag[i].id.split(",")[1];                        if (type == "tableset") {                            tableset[name].value = tag[i].value;                        }                        if (type == "mapset") {                            mapset[name].value = tag[i].value;                        }                    }                }                orderBy();                viewData();            };            div.appendChild(button);            return div;        }catch (e) {            showMessage("getConfigsContent:\n" + e.message)        }    }    function getMapContent(columnid) {        //数据缩略图        try {            var div = document.createElement("div");            div.id = ["MAP", columnid].toString();            div.style.cssText = getStyle({                "width": mapset.map_width.value + "px",                "height": mapset.map_height.value + "px",                "background-color": mapset.map_backgroundColor.value,                "color": mapset.map_color.value,                "text-align": "center",                "border-bottom": "gray 1px solid",                "padding": "10px",                "margin": "0px",                "display": "none",                "position": "absolute",                "top": "60px",                "font-size": "100%",                "border-radius": "5px"            });            div.onmouseleave = function () {                this.style.display = "none";            };            var map_column = document.createElement("div");            map_column.style.cssText = getStyle({                "height": "25px",                "width": "100%",                "border-bottom": "yellow 1px solid",                "margin-bottom": "10px"            });            map_column.innerHTML = _COLUMNS_[columnid].name;            div.appendChild(map_column);            var canvas = document.createElement("canvas");            //获取基础数据并画图            canvas.id = ["canvas", columnid].toString();            canvas.width = mapset.map_width.value;            canvas.height = mapset.map_height.value - 50;            //不能使用style设置,不要用像素单位,防止拉伸.            //-50是预留标题和页脚空间.            canvas.style.borderBottom = "yellow 1px solid";            canvas.innerText = "浏览器不支持HTML5,请使用IE9及以上版本，或使用Google Chrome浏览器。";            var names = [];            var values = [];            var maxvalue = _DATA_[0].data[columnid];            var minvalue = _DATA_[0].data[columnid];            var po = {"x": 0, "y": 0};            var sumvalues = 0;            for (var i = 0; i < _DATA_.length; i++) {                if (_DATA_[i].display == true) {                    sumvalues += _DATA_[i].data[columnid];                    names.push(_DATA_[i].data[mapset.row_title_id.value]);                    values.push(_DATA_[i].data[columnid]);                    if (_DATA_[i].data[columnid] > maxvalue) {                        maxvalue = _DATA_[i].data[columnid];                    }                    if (_DATA_[i].data[columnid] < minvalue) {                        minvalue = _DATA_[i].data[columnid];                    }                }            }            var dw = {"x": (canvas.width - 5) / values.length, "y": 0.1};            if (maxvalue >= 0 && minvalue >= 0) {                dw.y = maxvalue / (canvas.height - 20);                po = {"x": 1, "y": canvas.height - 15};            }            if (maxvalue >= 0 && minvalue < 0) {                dw.y = (maxvalue + Math.abs(minvalue)) / (canvas.height - 20);                po = {"x": 1, "y": canvas.height - 15 - Math.abs(minvalue) / dw.y};            }            if (maxvalue < 0 && minvalue < 0) {                dw.y = Math.abs(minvalue) / (canvas.height - 20);                po = {"x": 1, "y": canvas.height - 15 - Math.abs(minvalue) / dw.y};            }            var avg = {"value": sumvalues / values.length, "y": po.y - sumvalues / values.length / dw.y};            div.appendChild(canvas);            //如果仅以IMG方式显示，可不将画布增加到DIV.            //如果需要直接CANVAS展示，则必须增加到DIV。            try {                var img = document.createElement("img");                img.id = "im" + columnid;                //不要设置图片尺寸（使用图片原始尺寸），防止拉伸变形，否则造成map热点区域不准确.                img.src = "";                img.style.cssText = getStyle({                    "border": "none",                    "border-bottom": "yellow 1px solid",                    "margin": "0px",                    "padding": "0px"                });                img.setAttribute("usemap", "#map" + columnid);                var m = document.createElement("map");                m.id = "map" + columnid;                m.setAttribute("name", "map" + columnid);                var context = canvas.getContext("2d");                context.font = "5px " + tableset.fontFamily.value;                context.strokeStyle = mapset.map_color.value;//"#C0C0C0";                if (mapset.map_type.value == 0) {                    //柱状图                    context.lineWidth = 1;                    context.shadowColor = "#000000";//设置阴影颜色                    context.shadowOffsetX = 1;//设置形状或路径x轴方向的阴影偏移量，默认值为0；                    context.shadowOffsetY = 1;//设置形状或路径y轴方向的阴影偏移量，默认值为0；                    context.shadowBlur = 5;//设置模糊的像素数，默认值为0，即不模糊                    context.beginPath();                    context.moveTo(0, po.y);                    context.lineTo(canvas.width, po.y);                    context.moveTo(po.x, 0);                    context.lineTo(po.x, canvas.height);                    context.stroke();                    context.beginPath();                    for (var i = 0; i < values.length; i++) {                        var area = document.createElement("area");                        area.id = "area" + i;                        area.shape = "rect";                        var bar = {"x": 0, "y": 0, "w": 0, "h": 0};                        if (values[i] >= 0) {                            bar.x = Math.round(po.x + i * dw.x);                            bar.y = Math.round(po.y - values[i] / dw.y);                            //左上角坐标:[x,y]                            bar.w = Math.round(dw.x - 1);                            bar.h = Math.round(values[i] / dw.y);                        } else {                            bar.x = Math.round(po.x + i * dw.x);                            bar.y = Math.round(po.y);                            bar.w = Math.round(dw.x - 1);                            bar.h = Math.round(Math.abs(values[i]) / dw.y);                        }                        context.lineWidth = 0.5;                        if (values[i] == maxvalue) {                            context.fillStyle = mapset.map_max_color.value;                        } else if (values[i] == minvalue) {                            context.fillStyle = mapset.map_min_color.value;                        } else {                            context.fillStyle = mapset.map_color.value;                        }                        context.fillRect(bar.x, bar.y, bar.w, bar.h);                        context.strokeRect(bar.x, bar.y, bar.w, bar.h);                        context.stroke();                        area.coords = [bar.x, bar.y, bar.x + bar.w, bar.y + bar.h].toString();                        //area.coords参数规范:左上角坐标[x0,y0] 和右下角坐标[x1,x1]                        area.id = [columnid, names[i], values[i]].toString();                        area.href = "#";                        area.onmousemove = function (e) {                            var parent = document.getElementById(["MAP", parseInt(this.id.split(",")[0])].toString());                            var map_tip = document.getElementById("map_tip" + this.id.split(",")[0]);                            map_tip.innerHTML = this.id.split(",")[1] + ":<br>" + this.id.split(",")[2];                            map_tip.style.display = "block";                            map_tip.style.top = (e.clientY - getOffsetTop(parent) - 10) + "px";                            if ((e.clientX - getOffsetLeft(parent) + 15 + parseInt(map_tip.style.width)) > parseInt(parent.style.width)) {                                map_tip.style.left = (e.clientX - getOffsetLeft(parent) - 15 - parseInt(map_tip.style.width)) + "px";                            } else {                                map_tip.style.left = (e.clientX - getOffsetLeft(parent) + 15) + "px";                            }                        };                        area.onmouseout = function () {                            var map_tip = document.getElementById("map_tip" + this.id.split(",")[0]);                            map_tip.innerHTML = "";                            map_tip.style.display = "none";                        };                        m.appendChild(area);                    }                    context.stroke();                    if (mapset.avg_line.value == 1) {                        //context.setLineDash方法存在兼容性问题。                        for (var i = po.x; i < canvas.width - 5; i += 8) {                            context.beginPath();                            context.lineWidth = 0.5;                            context.moveTo(i, avg.y);                            context.lineTo(i + 5, avg.y);                            context.stroke();                        }                    }                }                if (mapset.map_type.value == 1) {                    //线型图                    context.lineWidth = 1;                    context.shadowColor = "#000000";//设置阴影颜色                    context.shadowOffsetX = 1;//设置形状或路径x轴方向的阴影偏移量，默认值为0；                    context.shadowOffsetY = 1;//设置形状或路径y轴方向的阴影偏移量，默认值为0；                    context.shadowBlur = 4;//设置模糊的像素数，默认值为0，即不模糊                    context.beginPath();                    context.moveTo(0, po.y);                    context.lineTo(canvas.width, po.y);                    context.moveTo(po.x, 0);                    context.lineTo(po.x, canvas.height);                    context.stroke();                    var points = [];                    for (var i = 0; i < values.length; i++) {                        var area = document.createElement("area");                        area.id = "area" + i;                        area.shape = "circle";                        var point = {"x": 0, "y": 0, "value": values[i]};                        if (values[i] >= 0) {                            point.x = Math.round(po.x + i * dw.x + dw.x / 2);                            point.y = Math.round(po.y - values[i] / dw.y);                        } else {                            point.x = Math.round(po.x + i * dw.x + dw.x / 2);                            point.y = Math.round(po.y) + Math.round(Math.abs(values[i]) / dw.y);                        }                        points.push(point);                        area.coords = [point.x, point.y, 3].toString();                        //area.coords参数规范:圆心[x0,y0] ,半径r                        area.id = [columnid, names[i], values[i]].toString();                        area.href = "#";                        area.onmousemove = function (e) {                            var parent = document.getElementById(["MAP", parseInt(this.id.split(",")[0])].toString());                            var map_tip = document.getElementById("map_tip" + this.id.split(",")[0]);                            map_tip.innerHTML = this.id.split(",")[1] + ":<br>" + this.id.split(",")[2];                            map_tip.style.display = "block";                            map_tip.style.top = (e.clientY - getOffsetTop(parent) - 10) + "px";                            if ((e.clientX - getOffsetLeft(parent) + 15 + parseInt(map_tip.style.width)) > parseInt(parent.style.width)) {                                map_tip.style.left = (e.clientX - getOffsetLeft(parent) - 15 - parseInt(map_tip.style.width)) + "px";                            } else {                                map_tip.style.left = (e.clientX - getOffsetLeft(parent) + 15) + "px";                            }                        };                        area.onmouseout = function () {                            var map_tip = document.getElementById("map_tip" + this.id.split(",")[0]);                            map_tip.innerHTML = "";                            map_tip.style.display = "none";                        };                        m.appendChild(area);                    }                    context.beginPath();                    context.strokeStyle = mapset.map_color.value;                    context.lineWidth = 1;                    context.moveTo(points[0].x, points[0].y);                    for (i = 1; i < points.length; i++) {                        var Xoffsize = (points[i].x - points[i - 1].x) * 0.33;                        //三次贝塞尔曲线实现平滑:在两点间增加两点.                        // 通过控制两点的偏移量实现平滑度，X偏移量不能太小,Y的偏移量越小效果越好.甚至可以为0.                        var ctrPointA = {"x": points[i - 1].x + Xoffsize, "y": points[i - 1].y};                        var ctrPointB = {"x": points[i].x - Xoffsize, "y": points[i].y};                        var Yoffsize = Math.abs(points[i].y - points[i - 1].y) * 0.02;                        if (points[i].y >= points[i - 1].y) {                            ctrPointA.y = points[i - 1].y + Yoffsize;                            ctrPointB.y = points[i].y - Yoffsize;                        } else {                            ctrPointA.y = points[i - 1].y - Yoffsize;                            ctrPointB.y = points[i].y + Yoffsize;                        }                        context.bezierCurveTo(ctrPointA.x, ctrPointA.y, ctrPointB.x, ctrPointB.y, points[i].x, points[i].y);                    }                    context.stroke();                    for (i = 0; i < points.length; i++) {                        context.beginPath();                        context.arc(points[i].x, points[i].y, 2, 0, Math.PI * 2, true);                        if (points[i].value == maxvalue) {                            context.strokeStyle = mapset.map_max_color.value;                        } else if (points[i].value == minvalue) {                            context.strokeStyle = mapset.map_min_color.value;                        } else {                            context.strokeStyle = mapset.map_color.value;                        }                        context.fillStyle = mapset.map_backgroundColor.value;                        context.closePath();                        context.fill();                        context.stroke();                    }                    if (mapset.avg_line.value == 1) {                        //context.setLineDash方法存在兼容性问题。                        context.strokeStyle = mapset.map_color.value;                        for (var i = po.x; i < canvas.width - 5; i += 8) {                            context.beginPath();                            context.lineWidth = 0.5;                            context.moveTo(i, avg.y);                            context.lineTo(i + 5, avg.y);                            context.stroke();                        }                    }                }                if (mapset.map_type.value == 2) {                    //饼图                    var arcs = [];                    var po = {                        "x": canvas.width / 2 + Math.abs(canvas.width - canvas.height) / 2,                        "y": canvas.height / 2                    };                    var r = Math.min(canvas.width / 2, canvas.height / 2) - 3;                    context.lineWidth = 1;                    var startAngle = 0;                    var posX = 1, posY = 1, stX = 0;//标识起始位置及横向步进倍数                    var tWidth = 10, tHeight = 10, infoWidth = 100;//标识的宽度、高度和文本宽度                    for (i = 0; i < values.length; i++) {                        var coords_tag = [posX + stX * infoWidth, posY, posX + stX * infoWidth + tWidth, posY + tHeight];                        var coords = [po.x, po.y];                        var percent = 0;                        if ((sumvalues > 0 && minvalue >= 0) || (sumvalues < 0 && maxvalue <= 0)) {                            percent = Math.round(values[i] / sumvalues * 10000) / 100;                        }                        if (sumvalues > 0 && minvalue < 0) {                            percent = Math.round((values[i] + Math.abs(minvalue)) / (sumvalues + Math.abs(minvalue) * values.length) * 10000) / 100;                        }                        if (sumvalues < 0 && maxvalue > 0) {                            percent = Math.round((values[i] - Math.abs(maxvalue)) / (sumvalues - Math.abs(maxvalue) * values.length) * 10000) / 100;                        }                        var endAngle = startAngle + Math.PI * 2 * percent / 100;                        //计算饼图热点的多边形                        for (var lineAngle = startAngle; lineAngle <= endAngle; lineAngle += 0.01) {                            var coord = {"x": 0, "y": 0};                            coord.x = po.x + r * Math.cos(lineAngle);//圆弧上线与圆相交点的x坐标                            coord.y = po.y + r * Math.sin(lineAngle);//圆弧上线与圆相交点的y坐标                            coords.push(coord.x);                            coords.push(coord.y);                        }                        arcs.push({                            "name": names[i],                            "value": values[i],                            "percent": percent + "%",                            "startAngle": startAngle,                            "endAngle": endAngle,                            "color": colors[i % colors.length],                            "coords": coords,                            "coords_tag": coords_tag                        });                        startAngle = endAngle;                        //计算标识位置                        if (posY > (canvas.height - 2 * tHeight)) {                            stX++;                            posY = 1;                        } else {                            posY = posY + 12                        }                    }                    context.lineWidth = 1;                    context.shadowColor = "#000000";                    context.shadowOffsetX = 1;                    context.shadowOffsetY = 1;                    context.shadowBlur = 4;                    context.save();                    //必须保存，否则平移后不能还原.                    context.strokeStyle = mapset.map_color.value;                    context.translate(po.x, po.y);                    for (i = 0; i < arcs.length; i++) {                        context.beginPath();                        context.moveTo(0, 0);                        context.fillStyle = arcs[i].color;                        context.arc(0, 0, r, arcs[i].startAngle, arcs[i].endAngle);                        context.fill();                        context.strokeStyle = "#C0C0C0";                        context.closePath();                        context.stroke();                    }                    context.beginPath();                    context.moveTo(0, 0);                    context.lineWidth = 1;                    context.arc(0, 0, 8, 0, 2 * Math.PI);                    context.fillStyle = mapset.map_backgroundColor.value;                    context.fill();                    context.strokeStyle = mapset.map_backgroundColor.value;//"#C0C0C0";                    context.closePath();                    context.stroke();                    context.restore();                    //恢复平移                    context.textAlign = "left";                    for (var i = 0; i < arcs.length; i++) {                        //绘制比例图及文字                        context.fillStyle = arcs[i].color;                        context.fillRect(arcs[i].coords_tag[0], arcs[i].coords_tag[1], tWidth, tHeight);                        context.font = "10px " + tableset.fontFamily.value;                        context.fillStyle = mapset.map_color.value;                        var infor = arcs[i].name + ":" + values[i];                        context.fillText(infor, arcs[i].coords_tag[0] + tWidth + 5, arcs[i].coords_tag[1] + 9);                        context.stroke();                        //处理标识热点                        var area = document.createElement("area");                        area.shape = "rect";                        area.coords = arcs[i].coords_tag.toString();                        //area.coords参数规范:左上角坐标[x0,y0] 和右下角坐标[x1,x1]                        area.id = ["rect", columnid, names[i], arcs[i].percent].toString();                        area.href = "#";                        area.onmousemove = function (e) {                            var parent = document.getElementById(["MAP", parseInt(this.id.split(",")[1])].toString());                            var map_tip = document.getElementById("map_tip" + this.id.split(",")[1]);                            map_tip.innerHTML = this.id.split(",")[2] + ":<br>" + this.id.split(",")[3];                            map_tip.style.display = "block";                            map_tip.style.top = (e.clientY - getOffsetTop(parent) - 10) + "px";                            if ((e.clientX - getOffsetLeft(parent) + 15 + parseInt(map_tip.style.width)) > parseInt(parent.style.width)) {                                map_tip.style.left = (e.clientX - getOffsetLeft(parent) - 15 - parseInt(map_tip.style.width)) + "px";                            } else {                                map_tip.style.left = (e.clientX - getOffsetLeft(parent) + 15) + "px";                            }                        };                        area.onmouseout = function () {                            var map_tip = document.getElementById("map_tip" + this.id.split(",")[1]);                            map_tip.innerHTML = "";                            map_tip.style.display = "none";                        };                        m.appendChild(area);                        //处理饼图热点                        area = document.createElement("area");                        area.shape = "poly";                        area.coords = arcs[i].coords.toString();                        area.id = ["poly", columnid, names[i], arcs[i].percent].toString();                        area.href = "#";                        area.onmousemove = function (e) {                            var parent = document.getElementById(["MAP", parseInt(this.id.split(",")[1])].toString());                            var map_tip = document.getElementById("map_tip" + this.id.split(",")[1]);                            map_tip.innerHTML = this.id.split(",")[2] + ":<br>" + this.id.split(",")[3];                            map_tip.style.display = "block";                            map_tip.style.top = (e.clientY - getOffsetTop(parent) - 10) + "px";                            if ((e.clientX - getOffsetLeft(parent) + 15 + parseInt(map_tip.style.width)) > parseInt(parent.style.width)) {                                map_tip.style.left = (e.clientX - getOffsetLeft(parent) - 15 - parseInt(map_tip.style.width)) + "px";                            } else {                                map_tip.style.left = (e.clientX - getOffsetLeft(parent) + 15) + "px";                            }                        };                        area.onmouseout = function () {                            var map_tip = document.getElementById("map_tip" + this.id.split(",")[1]);                            map_tip.innerHTML = "";                            map_tip.style.display = "none";                        };                        m.appendChild(area);                    }                }                if (mapset.map_type.value == 3) {                    //散点图                    var names = [];                    var maxname = _DATA_[0].data[mapset.row_title_id.value];                    var minname = _DATA_[0].data[mapset.row_title_id.value];                    var sumnames = 0;                    for (var i = 0; i < _DATA_.length; i++) {                        if (_DATA_[i].display == true) {                            sumnames += _DATA_[i].data[mapset.row_title_id.value];                            names.push(_DATA_[i].data[mapset.row_title_id.value]);                            if (_DATA_[i].data[mapset.row_title_id.value] > maxname) {                                maxname = _DATA_[i].data[mapset.row_title_id.value];                            }                            if (_DATA_[i].data[mapset.row_title_id.value] < minname) {                                minname = _DATA_[i].data[mapset.row_title_id.value];                            }                        }                    }                    if (maxname >= 0 && minname >= 0) {                        dw.x = maxname / (canvas.width - 5);                        po.x = 1;                    }                    if (maxname >= 0 && minname < 0) {                        dw.x = (maxname + Math.abs(minname)) / (canvas.width - 5);                        po.x = Math.abs(minname) / dw.x + 1;                    }                    if (maxname < 0 && minname < 0) {                        dw.x = Math.abs(minname) / (canvas.width - 5);                        po.x = canvas.width - 5;                    }                    var points = [];                    for (var i = 0; i < values.length; i++) {                        var point = {"x": 0, "y": 0, "xValue": values[i], "yValue": names[i]};                        point.x = Math.round(po.x + names[i] / dw.x);                        if (values[i] >= 0) {                            point.y = Math.round(po.y - values[i] / dw.y);                        } else {                            point.y = Math.round(po.y + Math.abs(values[i]) / dw.y);                        }                        points.push(point);                    }                    context.lineWidth = 1;                    context.shadowColor = "#000000";//设置阴影颜色                    context.shadowOffsetX = 1;//设置形状或路径x轴方向的阴影偏移量，默认值为0；                    context.shadowOffsetY = 1;//设置形状或路径y轴方向的阴影偏移量，默认值为0；                    context.shadowBlur = 4;//设置模糊的像素数，默认值为0，即不模糊                    for (i = 0; i < points.length; i++) {                        context.beginPath();                        context.arc(points[i].x, points[i].y, 2, 0, Math.PI * 2, true);                        if (points[i].value == maxvalue) {                            context.strokeStyle = mapset.map_max_color.value;                        } else if (points[i].value == minvalue) {                            context.strokeStyle = mapset.map_min_color.value;                        } else {                            context.strokeStyle = mapset.map_color.value;                        }                        context.fillStyle = mapset.map_backgroundColor.value;                        context.closePath();                        context.fill();                        context.stroke();                        var area = document.createElement("area");                        area.id = "area" + i;                        area.shape = "circle";                        area.coords = [points[i].x, points[i].y, 4].toString();                        //area.coords参数规范:圆心[x0,y0] ,半径r                        area.id = [columnid, points[i].yValue, points[i].xValue].toString();                        area.href = "#";                        area.onmousemove = function (e) {                            var parent = document.getElementById(["MAP", parseInt(this.id.split(",")[0])].toString());                            var map_tip = document.getElementById("map_tip" + this.id.split(",")[0]);                            map_tip.innerHTML = this.id.split(",")[1] + ":<br>" + this.id.split(",")[2];                            map_tip.style.display = "block";                            map_tip.style.top = (e.clientY - getOffsetTop(parent) - 10) + "px";                            if ((e.clientX - getOffsetLeft(parent) + 15 + parseInt(map_tip.style.width)) > parseInt(parent.style.width)) {                                map_tip.style.left = (e.clientX - getOffsetLeft(parent) - 15 - parseInt(map_tip.style.width)) + "px";                            } else {                                map_tip.style.left = (e.clientX - getOffsetLeft(parent) + 15) + "px";                            }                        };                        area.onmouseout = function () {                            var map_tip = document.getElementById("map_tip" + this.id.split(",")[0]);                            map_tip.innerHTML = "";                            map_tip.style.display = "none";                        };                        m.appendChild(area);                    }                    if (mapset.trend_line.value == 1) {                        var mole = 0;                        var deno = 0;                        for (var i = 0; i < names.length; i++) {                            mole += (names[i] - sumnames / names.length) * (values[i] - sumvalues / values.length);                            deno += Math.pow((names[i] - sumnames / names.length), 2);                        }                        var B = mole / deno;                        var A = sumvalues / values.length - B * (sumnames / names.length);                        context.beginPath();                        context.fillStyle = mapset.map_color.value;                        context.font = "10px " + tableset.fontFamily.value;                        var infor = "Y = " + Math.round(A * 100) / 100 + " + (" + Math.round(B * 100) / 100 + ")X";                        context.fillText(infor, 10, 10);                        context.stroke();                        //Y = A + BX                        //context.setLineDash([5, 3])方法存在兼容性问题，无法使用minname和maxname运算。                        context.beginPath();                        context.lineWidth = 0.5;                        for (var X = 1; X < canvas.width - 5; X += 8) {                            var x = (X - po.x) * dw.x;                            var y = A + B * x;                            if (y >= 0) {                                var Y = Math.round(po.y - y / dw.y);                            } else {                                var Y = Math.round(po.y + Math.abs(y) / dw.y);                            }                            var X1 = X + 5;                            x = (X1 - po.x) * dw.x;                            y = A + B * x;                            if (y >= 0) {                                var Y1 = Math.round(po.y - y / dw.y);                            } else {                                var Y1 = Math.round(po.y + Math.abs(y) / dw.y);                            }                            context.moveTo(X, Y);                            context.lineTo(X1, Y1);                        }                         context.stroke();                    }                    context.beginPath();                    context.lineWidth = 1;                    context.moveTo(0, po.y);                    context.lineTo(canvas.width, po.y);                    context.moveTo(po.x, 0);                    context.lineTo(po.x, canvas.height);                    context.stroke();                }                div.appendChild(img);                div.appendChild(m);                var ss = canvas.toDataURL("image/png");                //将画布转换为图片链接                img.src = ss;                div.removeChild(canvas);            } catch (e) {                canvas.innerHTML = "浏览器不支持该HTML5！请使用IE9及以上版本，或使用Google Chrome浏览器。<br>错误信息:" + e.message;            }            var map_tip = document.createElement("div");            map_tip.id="map_tip"+ columnid;            map_tip.style.cssText = getStyle({                "zIndex": "1",                "position": "absolute",                "color": mapset.map_tip_color.value,                "display": "none",                "background-color": mapset.map_tip_backgroundColor.value,                "opacity": "0.80",                "height": "30px",                "width": "75px",                "text-align": "left",                "line-height": "15px",                "padding-top": "5px",                "padding-left": "5px",                "padding-bottom": "5px",            });            div.appendChild(map_tip);            return div;        }catch (e) {            showMessage("getMapContent:\n" + e.message);        }    }    function getOffsetTop(obj) {        //获取绝对Top位置        var tmp = obj.offsetTop;        var val = obj.offsetParent;        while (val != null) {            tmp += val.offsetTop;            val = val.offsetParent;        }        return tmp;    }    function getOffsetLeft(obj) {        //获取绝对Left位置        var tmp = obj.offsetLeft;        var val = obj.offsetParent;        while (val != null) {            tmp += val.offsetLeft;            val = val.offsetParent;        }        return tmp;    }    function getRowDisplay(columnid, value){        var display = true;        for (var i = 0 ;i < _DATA_.length; i ++){            if (_DATA_[i].data[columnid] == value){                display = _DATA_[i].display;                break;            }        }        return display;    }    function GetFilterContent(columnid) {        //筛选功能        try {            var div = document.createElement("div");            div.id = ["FILTER", columnid].toString();            div.style.cssText = getStyle({                "text-align": "center",                "background-color": tableset.filter_background.value,                "border-bottom ": "gray 1px solid",                "color": tableset.filter_color.value,                "padding": "10px",                "margin": "0px",                "display": "none",                "position": "absolute",                "top": "0px",                "left": "103px",                "width": "200px",                "height": "305px",                "font-size": "100%",                "border-radius": "5px"            });            var filter_column = document.createElement("div");            filter_column.style.cssText = getStyle({                "width": "100%",                "height": "30px",                "border-bottom": "yellow 1px solid"            });            filter_column.innerHTML = _COLUMNS_[columnid].name;            div.appendChild(filter_column);            var list = document.createElement("div");            list.style.cssText = getStyle({                "width": "100%",                "height": "210px",                "overflow": "auto",                "background-color": tableset.filter_background.value,                "border-bottom": "yellow 1px solid"            });            var groups = groupBy(columnid);            for (var i = 0; i < groups.length; i++) {                var li = document.createElement("div");                li.style.cssText = getStyle({                    "margin-top": "0px",                    "margin-bottom": "0px",                    "padding-top": "0px",                    "padding-bottom": "0px",                    "line-height": "3px",                    "width": "100%",                    "text-align": "left",                });                var checkbox = document.createElement("input");                checkbox.id = ["checkbox", columnid, i].toString();                checkbox.setAttribute("type", "checkbox");                if (getRowDisplay(columnid, groups[i]) == true) {                    checkbox.setAttribute("checked", "checked");                }                checkbox.onclick = function () {                    if (this.checked == false) {                        this.removeAttribute("checked");                    } else {                        this.setAttribute("checked", "checked");                    }                    //必须将checked和Attribute修改为同步状态。                };                li.appendChild(checkbox);                var a = document.createElement("a");                a.innerHTML = groups[i];                li.appendChild(a);                list.appendChild(li);            }            div.appendChild(list);            var select = document.createElement("div");            select.style.cssText = getStyle({                "margin-top": "0px",                "margin-bottom": "0px",                "padding-top": "0px",                "padding-bottom": "0px",                "width": "100%",                "height": "30px",                "text-align": "left"            });            var checkall = document.createElement("input");            checkall.id = ["CHECKALL", columnid, i].toString();            checkall.setAttribute("type", "checkbox");            checkall.setAttribute("checked", "checked");            checkall.setAttribute("groups", groups.toString());            checkall.setAttribute("columnid", columnid);            checkall.onclick = function () {                var groups = this.getAttribute("groups").split(",");                var columnid = this.getAttribute("columnid");                for (var i = 0; i < groups.length; i++) {                    var checkbox = document.getElementById(["checkbox", columnid, i].toString());                    if (this.checked == true) {                        checkbox.setAttribute("checked", "checked");                        checkbox.checked = true;                    } else {                        checkbox.removeAttribute("checked");                        checkbox.checked = false;                    }                    //必须将checked和Attribute修改为同步状态。                }            };            select.appendChild(checkall);            var a = document.createElement("a");            a.innerText = "全选";            a.style.cssText = getStyle({                "width": "100%",                "text-align": "left"            });            select.appendChild(a);            div.appendChild(select);            var hr = document.createElement("hr");            div.appendChild(hr);            var button = document.createElement("a");            button.innerText = "[确定]";            button.setAttribute("columnid", columnid);            button.setAttribute("groups", groups);            button.onclick = function () {                var groups = this.getAttribute("groups").split(",");                var columnid = this.getAttribute("columnid");                for (var i = 0; i < groups.length; i++) {                    var checkbox = document.getElementById(["checkbox", columnid, i].toString());                    for (var d = 0; d < _DATA_.length; d++) {                        if (_DATA_[d].data[columnid] == groups[i] && checkbox.checked == false) {                            _DATA_[d].display = false;                        }                        if (_DATA_[d].data[columnid] == groups[i] && checkbox.checked == true) {                            _DATA_[d].display = true;                        }                    }                }                tableset.current_page.value = 1;                //重置当前页码                orderBy();                //筛选后重新排序,让隐藏行排在后面。                viewData();            };            div.appendChild(button);            return div;        }catch (e) {            showMessage("GetFilterContent:\n" + e.message);        }    }    function GetMenuItems(columnid){        try {            var ul = document.createElement("ul");            ul.id = ["MENU", columnid].toString();            ul.style.cssText = getStyle({                "list-style-type": "none",                "display": "none",                "padding": "0",                "margin": "0",                "position": "absolute",                "top": "20px",                "left": "15px",                "width": "105px",            });            ul.onmouseleave = function () {                this.style.display = "none";                var filter = document.getElementById(["FILTER", columnid].toString());                filter.style.display = "none";                var map = document.getElementById(["MAP", columnid].toString());                map.style.display = "none";            };            var liStyle = {                "color": "#000000",                "background-color": tableset.menu_item_default.value,                "display": "block",                "text-align": "center",                "text-decoration": "none",                "width": "104px",                "height": "29px",                "border": "none",                "border-bottom": "brown 1px solid",                "line-height": "31px",                "font-size": "12px",                "border-radius": "5px"            };            //筛选菜单            var li = document.createElement("li");            li.id = ["item_filter", columnid].toString();            li.innerHTML = "筛选";            li.style.cssText = getStyle(liStyle);            li.appendChild(GetFilterContent(columnid));            li.onmouseenter = function () {                this.style.backgroundColor = tableset.menu_item_hot.value;            };            li.onmouseleave = function () {                this.style.backgroundColor = tableset.menu_item_default.value;            };            li.onclick = function () {                var filter = document.getElementById(["FILTER", columnid].toString());                filter.style.display = "block";                var map = document.getElementById(["MAP", columnid].toString());                map.style.display = "none";            };            ul.appendChild(li);            //隐藏菜单            var li = document.createElement("li");            li.id = ["item_hide", columnid].toString();            li.innerHTML = "隐藏";            li.style.cssText = getStyle(liStyle);            li.onmouseenter = function () {                this.style.backgroundColor = tableset.menu_item_hot.value;            };            li.onmouseleave = function () {                this.style.backgroundColor = tableset.menu_item_default.value;            };            li.onclick = function () {                _COLUMNS_[this.id.split(",")[1]].display = false;                viewData();            }            ul.appendChild(li);            //图形菜单            var li = document.createElement("li");            li.id = ["item_drawmap", columnid].toString();            li.innerHTML = "图形";            li.style.cssText = getStyle(liStyle);            var map = getMapContent(columnid);            if (map != "none") {                li.appendChild(map);            }            li.onmouseenter = function () {                this.style.backgroundColor = tableset.menu_item_hot.value;            };            li.onmouseleave = function () {                this.style.backgroundColor = tableset.menu_item_default.value;            };            li.onclick = function () {                var filter = document.getElementById(["FILTER", columnid].toString());                filter.style.display = "none";                var map = document.getElementById(["MAP", columnid].toString());                if ((getOffsetLeft(this) + parseInt(this.style.width) + parseInt(mapset.map_width.value)) > screen.availWidth){                    //如果右侧超出屏幕                     if (getOffsetLeft(this) - mapset.map_width.value >= 0) {                         map.style.left = (0 - mapset.map_width.value) + "px";                     } else {                         //如果左侧超出屏幕                         map.style.left = (0 - getOffsetLeft(this) + 10) + "px";                     }                } else {                    map.style.left = this.style.width;                }                map.style.display = "block";            };            ul.appendChild(li);            return ul;        }catch (e) {            showMessage("GetMenuItems:\n" + e.message);        }    }    function getColumnMenu(title, orderby, groupid){        try {            var div = document.createElement("div");            div.align = "center";            div.style.width = "100%";            var menu = document.createElement("table");            menu.style.width = "100%";            var mbody = document.createElement("tbody");            var row = document.createElement("tr");            var cell = document.createElement("td");            cell.style.cssText = getStyle({                "width": "8%",                "font-size": "100%",                "text-align": "center"            });            var span = document.createElement("span");            span.style.color = tableset.columns_order.value;            span.innerText = orderby;            cell.appendChild(span);            cell.onclick = function (){                if (tableset.order_type.value == 1){                    tableset.order_type.value = 2;                } else {                    tableset.order_type.value = 1;                }                tableset.order_by.value = groupid;                orderBy();            };            row.appendChild(cell);            cell = document.createElement("td");            cell.style.cssText = getStyle({                "text-align": "left",                "width": "95%"            });            var li = document.createElement("li");            li.innerHTML = title;            li.style.cssText = getStyle({                "list-style-type": "none",                "position": "relative",            });            li.float = "left";            li.appendChild(GetMenuItems(groupid));            li.onmouseenter = function(){            var menunul = document.getElementById(["MENU",groupid].toString());                menunul.style.display = "block";            };            cell.appendChild(li);            row.appendChild(cell);            mbody.appendChild(row);            menu.appendChild(mbody);            div.appendChild(menu);            return div;        }catch (e) {            showMessage("getColumnMenu:\n" + e.message)        }    }    function GetPageControl(count){        //分页控制       try{           var span = document.createElement("span");           span.style.cssText = getStyle({               "width": "200px",               "text-align": "center",               "font-size": "100%",               "color": tableset.subheading_color.value,               "font-weight": "bold"           });           var a = document.createElement("a");           a.innerText = "<<";           a.onclick = function() {               if (tableset.current_page.value > 1) {                   tableset.current_page.value --;                   viewData();               }           };           span.appendChild(a);           a = document.createElement("a");           a.innerHTML = "&nbsp;&nbsp;&nbsp;&nbsp;" + tableset.current_page.value + "&nbsp;&nbsp;&nbsp;&nbsp;";           span.appendChild(a);           a = document.createElement("a");           a.setAttribute("count", count.toString());           a.innerText = ">>";           a.onclick = function() {               var count = parseInt(this.getAttribute("count"));               if (tableset.current_page.value < Math.round((count / tableset.page_size.value + 0.5), 0)) {                   tableset.current_page.value ++;                   viewData();               }           };           span.appendChild(a);           return span;       } catch (e) {           showMessage("GetPageControl:\n" + e.message);       }    }    function getSums(){        //获取汇总数        var sums = [];        sums.push("SUM");        for (var c = 1; c < _COLUMNS_.length; c ++){            var sum = 0;            for (var i = 0; i < _DATA_.length; i ++){                try {                    if (_DATA_[i].display == true && typeof(_DATA_[i].data[c]) == "number") {                        sum += _DATA_[i].data[c];                    }                }catch(e){                }            }            sums.push(Math.round(sum*100)/100);        }        return sums;    }    function getAvgs(){        //获取平均数        var avgs = [];        avgs.push("AVG");        for (var c = 1; c < _COLUMNS_.length; c ++){            var sum = 0;            var count = 0;            for (var i = 0; i < _DATA_.length; i ++){                try {                    if (_DATA_[i].display == true && typeof(_DATA_[i].data[c]) == "number") {                        sum += _DATA_[i].data[c];                        count += 1;                    }                }catch(e){                }            }            avgs.push(Math.round(sum/count*100)/100);        }        return avgs;    }    function viewData(){        //报表显示主控        try{            if (_INITED_ == true) {                var main = document.getElementById("main");                main.innerHTML = "";                main.style.cssText = getStyle({                    "font-family": tableset.fontFamily.value,                    "font-size": tableset.fontSize.value,                });                var table = document.createElement("table");                table.id = "REPORT";                table.style.cssText = getStyle({                    "width": tableset.width.value,                    "text-align": "center",                    "cursor": "pointer"                });                <!--caption-->                var thead = document.createElement("thead");                var caption = document.createElement("tr");                var mcap = document.createElement("th");                mcap.colSpan = _COLUMNS_.length;                mcap.style.cssText = getStyle({                    "font-weight": "bold",                    "font-size": "150%",                    "text-align": "left",                    "color": tableset.mainheading_color.value                });                var span = document.createElement("span");                span.innerHTML = _CAPTIONS_[0].caption;                span.style.cssText = getStyle({                    "width": tableset.width.value,                    "list-style-type": "none",                    "position": "relative",                    "text-align": "center"                });                span.appendChild(getToolbox());                table.onmouseenter = function () {                    var mainmenu = document.getElementById("MAIN_MENU");                    mainmenu.style.display = "block";                };                table.onmouseleave = function () {                    var mainmenu = document.getElementById("MAIN_MENU");                    mainmenu.style.display = "none";                };                mcap.appendChild(span);                caption.appendChild(mcap);                thead.appendChild(caption);                caption = document.createElement("tr");                var scap = document.createElement("th");                scap.colSpan = _COLUMNS_.length;                scap.style.cssText = getStyle({                    "font-size": "70%",                    "text-align": "right",                    "color": tableset.subheading_color.value,                });                if (_CAPTIONS_.length > 1) {                    scap.innerHTML = _CAPTIONS_[1].caption;                } else {                    scap.innerHTML = "&nbsp;";                }                caption.appendChild(scap);                thead.appendChild(caption);                <!--header-->                var header = document.createElement("tr");                for (var i = 0; i < _COLUMNS_.length; i++) {                    var cell = document.createElement("th");                    cell.id = i.toString();                    cell.style.cssText = getStyle({                        "border": "none",                        "background-color": tableset.columns_background_default.value,                        "color": tableset.columns_color_default.value,                        "vertical-align": "middle",                        "border-radius": "5px",                        "border-spacing": "0",                        "border-padding": "0",                        "text-align": "center",                        "white-space":"nowrap"                    });                    if (_COLUMNS_[i].display == false) {                        cell.style.display = "none";                    }                    if (tableset.order_by.value == i) {                        if (tableset.order_type.value == 1) {                            cell.appendChild(getColumnMenu(_COLUMNS_[i].name, "▲", i));                        } else if (tableset.order_type.value == 2){                            cell.appendChild(getColumnMenu(_COLUMNS_[i].name, "▼", i));                        } else {                            cell.appendChild(getColumnMenu(_COLUMNS_[i].name, "●", i));                        }                    } else {                        cell.appendChild(getColumnMenu(_COLUMNS_[i].name, "●", i));                    }                    cell.onmouseenter = function () {                        this.style.backgroundColor = tableset.columns_background_hot.value;                        //清理所有菜单                        for (var i = 0; i < _COLUMNS_.length; i++) {                            if (this.id != i) {                                var menu = document.getElementById(["MENU", i].toString());                                menu.style.display = "none";                                var map = document.getElementById(["MAP", i].toString());                                map.style.display = "none";                            }                        }                        for (var i = 0; i < _DATA_.length; i++) {                            var c = document.getElementById([i, this.id].toString());                            c.style.color = tableset.data_color_hot.value;                            c.style.borderRadius = "5px";                            if (i % 2 > 0) {                                c.style.backgroundColor = tableset.data_background_hot_odd.value;                            } else {                                c.style.backgroundColor = tableset.data_background_hot_even.value;                            }                            var texts = c.getElementsByTagName("input");                            if (texts.length > 0) {                                texts[0].style.backgroundColor = c.style.backgroundColor;                            }                        }                    };                    cell.onmouseleave = function () {                        this.style.backgroundColor = tableset.columns_background_default.value;                        var menu = document.getElementById(["MENU", this.id].toString());                        menu.style.display = "none";                        var map = document.getElementById(["MAP", this.id].toString());                        map.style.display = "none";                        for (var i = 0; i < _DATA_.length; i++) {                            var c = document.getElementById([i, this.id].toString());                            c.style.color = tableset.data_color_default.value;                            c.style.borderRadius = "0px";                            if (i % 2 > 0) {                                c.style.backgroundColor = tableset.data_background_odd.value;                            } else {                                c.style.backgroundColor = tableset.data_background_even.value;                            }                            var texts = c.getElementsByTagName("input");                            if (texts.length > 0) {                                texts[0].style.backgroundColor = c.style.backgroundColor;                            }                        }                    };                    header.appendChild(cell);                }                thead.appendChild(header);                table.appendChild(thead);                var tfoot = document.createElement("tfoot");                var cellStyle = {                    "font-weight": "bold",                    "border": "none",                    "border-bottom": "brown 1px solid",                    "border-spacing": "0",                    "border-padding": "0",                    "border-radius": "2px",                    "background-color": tableset.data_background_odd.value                };                if (tableset.showSum.value == 1) {                    var footer = document.createElement("tr");                    var sums = getSums();                    for (var i = 0; i < _COLUMNS_.length; i++) {                        if (_COLUMNS_[i].display == true) {                            var cell = document.createElement("td");                            cell.style.cssText = getStyle(cellStyle);                            if (i == 0) {                                cell.style.textAlign = "center";                            } else {                                cell.style.textAlign = "right";                            }                            cell.innerText = sums[i];                            footer.appendChild(cell);                        }                    }                    tfoot.appendChild(footer);                }                if (tableset.showAvg.value == 1) {                    var footer = document.createElement("tr");                    var avgs = getAvgs();                    for (var i = 0; i < _COLUMNS_.length; i++) {                        if (_COLUMNS_[i].display == true) {                            var cell = document.createElement("td");                            cell.style.cssText = getStyle(cellStyle);                            if (i == 0) {                                cell.style.textAlign = "center";                            } else {                                cell.style.textAlign = "right";                            }                            cell.innerText = avgs[i];                            footer.appendChild(cell);                        }                        tfoot.appendChild(footer);                    }                }                var footer = document.createElement("tr");                var cell = document.createElement("td");                cell.colSpan = _COLUMNS_.length;                cell.style.cssText = getStyle({                    "font-size": "70%",                    "text-align": "right"                });                var div = document.createElement("div");                div.style.width = "100%";                var rowcount = 0;                for (var i = 0; i < _DATA_.length; i++) {                    if (_DATA_[i].display == true) {                        rowcount++;                    }                }                if (rowcount > tableset.page_size.value) {                    div.appendChild(GetPageControl(rowcount));                }                var span = document.createElement("span");                span.innerHTML = "&nbsp;&nbsp;制表:" + _INTERFACE_WRITER                    + "&nbsp;&nbsp;" + _INTERFACE_EDITTIME                    + ";&nbsp;模板开发:" + _SYS_DEVELOPER                    + "&copy;;&nbsp;代码版本:" + _SYS_VERSION;                div.appendChild(span);                cell.appendChild(div);                footer.appendChild(cell);                tfoot.appendChild(footer);                table.appendChild(tfoot);                <!--rows-->                var count = 0;                var minRow = (tableset.current_page.value - 1) * tableset.page_size.value + 1;                var maxRow = tableset.current_page.value * tableset.page_size.value;                var tbody = document.createElement("tbody");                for (var j = 0; j < _DATA_.length; j++) {                    var r = _DATA_[j].data;                    var row = document.createElement("tr");                    if (_DATA_[j].display == false) {                        row.style.display = "none";                    } else {                        count++;                        if (count < minRow || count > maxRow) {                            row.style.display = "none";                        }                    }                    for (var i = 0; i < _COLUMNS_.length; i++) {                        cell = document.createElement("td");                        cell.id = [j, i].toString();                        cell.style.cssText = getStyle({                            "font-weight": "none",                            "border": "none",                            "border-bottom": "brown 1px solid",                            "border-spacing": "0",                            "border-padding": "0",                            "border-radius": "2px"                        });                        if (_COLUMNS_[i].display == false) {                            cell.style.display = "none";                        }                        if (i == 0) {                            cell.style.textAlign = "center";                        } else {                            if (typeof(r[i]) == "number") {                                cell.style.textAlign = "right";                            } else {                                cell.style.textAlign = "left";                            }                        }                        if (j % 2 > 0) {                            cell.style.backgroundColor = tableset.data_background_odd.value;                        } else {                            cell.style.backgroundColor = tableset.data_background_even.value;                        }                        if (tableset.editable.value == 0) {                            cell.innerHTML = r[i];                        } else {                            var text = document.createElement("input");                            text.id = [j, i].toString();                            text.style.cssText = getStyle({                                "border": "none",                                "width": "100%",                                "height": "100%",                                "padding": "0px",                                "margin": "0px",                                "font-size": "100%",                                "border-radius": "2px"                            });                            text.type = "text";                            text.value = r[i];                            if (i == 0) {                                text.style.textAlign = "center";                            } else {                                if (typeof(r[i]) == "number") {                                    text.style.textAlign = "right";                                } else {                                    text.style.textAlign = "left";                                }                            }                            cell.appendChild(text);                            text.style.backgroundColor = cell.style.backgroundColor;                        }                        cell.onmouseenter = function () {                            for (var i = 0; i < _DATA_.length; i++) {                                var c = document.getElementById([i, this.id.split(",")[1]].toString());                                c.style.color = tableset.data_color_hot.value;                                c.style.borderRadius = "5px";                                if (i % 2 > 0) {                                    c.style.backgroundColor = tableset.data_background_hot_odd.value;                                } else {                                    c.style.backgroundColor = tableset.data_background_hot_even.value;                                }                                var texts = c.getElementsByTagName("input");                                if (texts.length > 0) {                                    texts[0].style.backgroundColor = c.style.backgroundColor;                                }                            }                            for (var i = 0; i < _COLUMNS_.length; i++) {                                var c = document.getElementById([this.id.split(",")[0], i].toString());                                c.style.color = tableset.data_color_hot.value;                                c.style.borderRadius = "5px";                                if (parseInt(this.id.split(",")[0]) % 2 > 0) {                                    c.style.backgroundColor = tableset.data_background_hot_odd.value;                                } else {                                    c.style.backgroundColor = tableset.data_background_hot_even.value;                                }                                var texts = c.getElementsByTagName("input");                                if (texts.length > 0) {                                    texts[0].style.backgroundColor = c.style.backgroundColor;                                }                            }                        };                        cell.onmouseleave = function () {                            for (var i = 0; i < _DATA_.length; i++) {                                var c = document.getElementById([i, this.id.split(",")[1]].toString());                                c.style.color = tableset.data_color_default.value;                                c.style.borderRadius = "2px";                                if (i % 2 > 0) {                                    c.style.backgroundColor = tableset.data_background_odd.value;                                } else {                                    c.style.backgroundColor = tableset.data_background_even.value;                                }                                var texts = c.getElementsByTagName("input");                                if (texts.length > 0) {                                    texts[0].style.backgroundColor = c.style.backgroundColor;                                }                            }                            for (var i = 0; i < _COLUMNS_.length; i++) {                                var c = document.getElementById([this.id.split(",")[0], i].toString());                                c.style.color = tableset.data_color_default.value;                                c.style.borderRadius = "2px";                                if (parseInt(this.id.split(",")[0]) % 2 > 0) {                                    c.style.backgroundColor = tableset.data_background_odd.value;                                } else {                                    c.style.backgroundColor = tableset.data_background_even.value;                                }                                var texts = c.getElementsByTagName("input");                                if (texts.length > 0){                                    texts[0].style.backgroundColor = c.style.backgroundColor;                                }                            }                        };                        row.appendChild(cell);                    }                    tbody.appendChild(row);                }                table.appendChild(tbody);                main.appendChild(table);            } else {                showMessage("接口数据初始化失败!");            }        }catch(e){            showMessage("viewData:\n" + e.message);        }    }    function initData() {        //数据初始化，注意：        // number,string类型都是基本类型，存放在栈区。        //对象和数组是通过引用来赋值的，所以改变a的同时b也会跟着改变。        //需要用slice复制原数组,避免原始数据被改变。        var inited = false;        try {            var captions = _INTERFACE_CAPTIONS.slice(0);            _CAPTIONS_ = [];            for (var i = 0; i < captions.length; i++) {                _CAPTIONS_.push({"id": i, "caption": captions[i]});            }            var columns = _INTERFACE_COLUMNS.slice(0);            _COLUMNS_ = [];            for (var i = 0; i < columns.length; i++) {                _COLUMNS_.push({"id": i, "name": columns[i], "display": true});            }            var data = _INTERFACE_DATA.slice(0);            _DATA_ = [];            for (var i = 0; i < data.length; i++) {                var ds = [];                for(var s = 0; s < data[i].length; s++){                    if (isNaN(Number(data[i][s]))) {                        ds.push(data[i][s]);                    }else{                        if (data[i][s] != "") {                            ds.push(Number(data[i][s]));                        } else {                            ds.push(data[i][s]);                        }                    }                }                _DATA_.push({"id": i, "data": ds, "display": true});            }            if (_COLUMNS_.length > 0 && _DATA_.length > 0) {                mapset.row_title_id.options = columns;                tableset.order_by.options = columns;                inited = true;            }        }catch (e) {            //showMessage("接口数据初始化失败!");        }        return inited;    }    try {        var _SYS_DEVELOPER = "杨凯";        var _SYS_VERSION = "2020/04/18 00:00(E)";        var _SYS_VERSION_LOGS = "Web SQLite DataView是JavaScript编程对静态HTML报表数据的二次拓展利用，" +            "可通过编辑、转置、排序、筛选、隐藏以及缩略图（柱状图、线性图、饼图和散点图）等功能，快速呈现数据特征;" +            "也可以调整页面参数显示不同效果。\n";        var _INTERFACE_TITLE = "Web SQLite Manager";        var _INTERFACE_WRITER = "杨凯";        var storage = window.localStorage;        var dataset = JSON.parse(storage.getItem("__WEB_SQLITE_DATASET__"));        var _INTERFACE_CAPTIONS = [dataset["title"],dataset["sub"]];        var _INTERFACE_COLUMNS = dataset["columns"];        //var columns = ["A","B","C"];        console.log(dataset["data"]);        var _INTERFACE_DATA = dataset["data"];        var _INTERFACE_EDITTIME = new Date();        document.title = _INTERFACE_TITLE;        var mapset = {            "map_type": {"value": 0, "name": "图形类别", "type": "select", "options": ["柱状图", "线型图", "饼图", "散点图"]},            "row_title_id": {"value": 0, "name": "行标题", "type": "select", "options": []},            "map_width": {"value": 800, "name": "图形控件宽度", "type": "text"},            "map_height": {"value": 400, "name": "图形控件高度", "type": "text"},            "avg_line": {"value": 1, "name": "显示平均线", "type": "select", "options": ["否", "是"]},            "trend_line": {"value": 1, "name": "显示趋势线", "type": "select", "options": ["否", "是"]},            "map_backgroundColor": {"value": "#006699", "name": "图形控件背景", "type": "color"},            "map_color": {"value": "#FFFAF0", "name": "图形控件颜色", "type": "color"},            "map_tip_backgroundColor": {"value": "#787878", "name": "信息提示背景颜色", "type": "color"},            "map_tip_color": {"value": "#FAA000", "name": "信息提示颜色", "type": "color"},            "map_max_color": {"value": "#FF6600", "name": "最大值颜色", "type": "color"},            "map_min_color": {"value": "#FF9966", "name": "最小值颜色", "type": "color"}        };        var tableset = {            "SourceFile":{"value": "", "name": "源文件", "type": "text"},            "Charset": {"value": 0, "name": "字符集", "type": "select", "options": ["GBK", "UTF-8"]},            "Separator": {"value": 0, "name": "分隔符", "type": "select", "options": [",","|", "\t"]},            "width": {"value": "1024px", "name": "报表宽度(px)", "type": "text"},            "fontFamily": {"value": "Verdana", "name": "报表字体", "type": "text"},            "fontSize": {"value": "12px", "name": "基础字号(px)", "type": "text"},            "order_by": {"value": 0, "name": "排序依据", "type": "select", "options": []},            "order_type": {"value": 0, "name": "排序方式", "type": "select", "options": ["默认", "顺序", "倒序"]},            "page_size": {"value": 45, "name": "分页行数", "type": "text"},            "current_page": {"value": 1, "name": "当前页码", "type": "text"},            "editable": {"value": 0, "name": "编辑状态", "type": "select", "options": ["否", "是"]},            "showSum": {"value": 0, "name": "显示汇总数", "type": "select", "options": ["否", "是"]},            "showAvg": {"value": 0, "name": "显示平均数", "type": "select", "options": ["否", "是"]},            "mainheading_color": {"value": "#8B0000", "name": "主标题颜色", "type": "color"},            "subheading_color": {"value": "#787878", "name": "副标题颜色", "type": "color"},            "columns_background_default": {"value": "#8B0000", "name": "表头背景(默认)", "type": "color"},            "columns_background_hot": {"value": "#5B0000", "name": "表头背景(选中)", "type": "color"},            "columns_color_default": {"value": "#FFFAF0", "name": "表头颜色(默认)", "type": "color"},            "data_color_default": {"value": "#000000", "name": "数据颜色(默认)", "type": "color"},            "data_color_hot": {"value": "#5B0000", "name": "数据颜色(选中)", "type": "color"},            "data_background_odd": {"value": "#FAEBD7", "name": "数据背景(单数默认)", "type": "color"},            "data_background_even": {"value": "#FFFAF0", "name": "数据背景(双数默认)", "type": "color"},            "data_background_hot_odd": {"value": "#A3D1D1", "name": "数据背景(单数选中)", "type": "color"},            "data_background_hot_even": {"value": "#D1E9E9", "name": "数据背景(双数选中)", "type": "color"},            "columns_order": {"value": "#FAA000", "name": "排序标志颜色", "type": "color"},            "menu_item_default": {"value": "#FFFFCC", "name": "菜单颜色(默认)", "type": "color"},            "menu_item_hot": {"value": "#3399CC", "name": "菜单颜色(选中)", "type": "color"},            "filter_background": {"value": "#006699", "name": "筛选控件背景", "type": "color"},            "filter_color": {"value": "#FFFFCC", "name": "筛选控件颜色", "type": "color"},            "config_background": {"value": "#006699", "name": "参数设置背景", "type": "color"},            "config_color": {"value": "#FFFFCC", "name": "参数设置颜色", "type": "color"},        };        var colors = (function () {            return ["#000000", "#000033", "#000066", "#0000CC", "#003300", "#003333",                "#003399", "#006699", "#330000", "#006666", "#006633", "#330033",                "#330066", "#330099", "#333399", "#336600", "#FF9966", "#3366CC",                "#660000", "#336666", "#660033", "#660066", "#003366", "#663300",                "#663366", "#663399", "#6633CC", "#666633", "#666666", "#666699",                "#6666CC", "#996633", "#996666", "#9966CC", "#999900", "#999933",                "#999999", "#9999CC", "#CC6633", "#CC6666", "#CC6699", "#CC66CC",                "#CC9900", "#CC9966", "#FF6600", "#FF6666", "#FF9900"].reverse();        })();        var _CAPTIONS_ = [];        var _COLUMNS_ = [];        var _DATA_ = [];        tableset.width.value = "1024px";        var _INITED_ = initData();        viewData();    }catch (e) {        showMessage("main:\n" + e.message)    }</script></body></html>